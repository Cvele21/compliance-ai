<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compliance AI | Universal Auditor</title>
    <style>
        body { 
            background-color: #0f172a; 
            color: #e2e8f0; 
            font-family: 'Segoe UI', monospace; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            min-height: 100vh; 
            margin: 0; 
            padding: 20px; 
            box-sizing: border-box; 
        }
        
        .select-container { margin-top: 30px; text-align: center; width: 100%; }
        select { 
            background-color: #1e293b; 
            color: white; 
            padding: 10px 20px; 
            font-size: 16px; 
            border: 1px solid #3b82f6; 
            border-radius: 5px; 
            cursor: pointer; 
            outline: none; 
            max-width: 100%; 
        }
        
        .drop-zone { 
            width: 90%; max-width: 600px; height: 200px; 
            border: 2px dashed #475569; border-radius: 10px; 
            display: flex; flex-direction: column; justify-content: center; align-items: center; 
            background-color: #1e293b; margin-top: 20px; 
            transition: all 0.3s; opacity: 0.5; pointer-events: none; 
            text-align: center; padding: 10px; box-sizing: border-box;
        }
        .drop-zone.unlocked { border-color: #3b82f6; opacity: 1; pointer-events: all; cursor: pointer; }
        .drop-zone.unlocked:hover { background-color: #334155; }
        .drop-zone.loading { border-color: #fbbf24; cursor: wait; }

        .legal-box { 
            background-color: #1e293b; border: 1px solid #ef4444; 
            padding: 15px; border-radius: 8px; margin-top: 20px; 
            width: 90%; max-width: 600px; 
            font-size: 14px; color: #cbd5e1; 
            display: flex; align-items: flex-start; gap: 15px; box-sizing: border-box;
        }
        
        .legal-box input { margin-top: 4px; transform: scale(1.5); flex-shrink: 0; cursor: pointer; }
        .legal-text { line-height: 1.4; }
        .highlight { color: #ef4444; font-weight: bold; }

        #report-container { 
            display: none; width: 90%; max-width: 800px; 
            background-color: #1e293b; border: 1px solid #475569; 
            border-radius: 8px; margin-top: 30px; padding: 20px; box-sizing: border-box;
            overflow-x: hidden; 
        }
        
        /* Buttons Container */
        .btn-container {
            display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; margin-bottom: 20px;
        }

        .btn-download { 
            background-color: #22c55e; color: black; font-weight: bold; 
            padding: 15px 30px; border: none; border-radius: 5px; 
            cursor: pointer; text-decoration: none; text-align: center;
            display: inline-block; flex: 1; min-width: 200px;
        }

        .btn-upgrade {
            background-color: #3b82f6; color: white; font-weight: bold;
            padding: 15px 30px; border: none; border-radius: 5px;
            cursor: pointer; text-decoration: none; text-align: center;
            display: inline-block; flex: 1; min-width: 200px;
        }
        
        pre { 
            white-space: pre-wrap; word-wrap: break-word; 
            color: #cbd5e1; line-height: 1.5; 
            font-family: 'Courier New', monospace; font-size: 13px; 
        }
    </style>
</head>
<body>
    <div style="text-align: center;"><h1>üõ°Ô∏è COMPLIANCE AI</h1><p>BETA // AUDIT READINESS PLATFORM</p></div>

    <div class="select-container">
        <label style="color: #94a3b8; display: block; margin-bottom: 5px;">SELECT STANDARD:</label>
        <select id="standard-select">
            <option value="NIST 800-171 Rev 2">NIST 800-171 (Defense/CMMC)</option>
            <option value="HIPAA Privacy Rule">HIPAA (Healthcare)</option>
            <option value="OSHA General Industry">OSHA (Workplace Safety)</option>
        </select>
    </div>

    <div class="legal-box">
        <input type="checkbox" id="legal-check">
        <div class="legal-text">
            <strong>REQUIRED:</strong> I understand that this report is generated by AI for <span class="highlight">educational and readiness purposes only</span>. It does NOT constitute legal advice.
        </div>
    </div>

    <div id="drop-zone" class="drop-zone">
        <div style="font-size: 40px;">üìÇ</div>
        <h3 id="status-text">Check Box Above to Unlock</h3>
    </div>

    <div id="report-container">
        
        <div class="btn-container">
            <a id="download-link" href="#" class="btn-download" target="_blank">üìÑ DOWNLOAD DRAFT</a>
            <a href="mailto:your-email@gmail.com?subject=Upgrade%20to%20Pro&body=I%20want%20to%20remove%20the%20watermark." class="btn-upgrade">
                ‚≠ê UNLOCK PRO
            </a>
        </div>

        <h3 id="report-title">üìã AUDIT RESULTS</h3>
        <pre id="report-content">Analysis...</pre>
    </div>

    <script>
        const dropZone = document.getElementById('drop-zone');
        const statusText = document.getElementById('status-text');
        const legalCheck = document.getElementById('legal-check');
        const standardSelect = document.getElementById('standard-select');
        const reportContainer = document.getElementById('report-container');
        const reportContent = document.getElementById('report-content');
        const downloadLink = document.getElementById('download-link');

        // UNLOCK LOGIC
        legalCheck.addEventListener('change', (e) => {
            if (e.target.checked) {
                dropZone.classList.add('unlocked');
                statusText.innerText = "Tap to Upload Policy PDF"; 
            } else {
                dropZone.classList.remove('unlocked');
                statusText.innerText = "Check Box Above to Unlock";
            }
        });

        // CLICK UPLOAD
        dropZone.addEventListener('click', () => {
            if (legalCheck.checked) {
                const fileInput = document.createElement('input');
                fileInput.type = 'file';
                fileInput.accept = 'application/pdf';
                fileInput.onchange = (e) => handleFile(e.target.files[0]);
                fileInput.click();
            }
        });

        // DRAG DROP UPLOAD
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, (e) => { e.preventDefault(); e.stopPropagation(); }, false);
        });

        dropZone.addEventListener('drop', (e) => {
            if (!legalCheck.checked) return;
            handleFile(e.dataTransfer.files[0]);
        }, false);

        // HANDLE FILE
        function handleFile(file) {
            if (!file) return;
            
            const selectedStandard = standardSelect.value;
            statusText.innerText = `üß† Auditing against ${selectedStandard}...`;
            dropZone.classList.add('loading');
            reportContainer.style.display = 'none';

            const formData = new FormData();
            formData.append('file', file);
            formData.append('standard', selectedStandard);

            // AUTO DETECT URL
            const uploadUrl = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1' 
                ? 'http://127.0.0.1:8000/upload' 
                : '/upload'; 

            fetch(uploadUrl, { method: 'POST', body: formData })
            .then(response => response.json())
            .then(data => {
                dropZone.classList.remove('loading');
                statusText.innerText = "‚úÖ Complete";
                reportContainer.style.display = 'block';
                document.getElementById('report-title').innerText = `üìã RESULTS: ${selectedStandard}`;
                reportContent.innerText = data.report;
                downloadLink.href = data.pdf_url;
                
                reportContainer.scrollIntoView({ behavior: 'smooth' });
            })
            .catch(error => { console.error(error); statusText.innerText = "Error"; });
        }
    </script>
</body>
</html>