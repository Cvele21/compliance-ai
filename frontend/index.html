<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compliance AI</title>
    <style>
        body { background-color: #0f172a; color: #e2e8f0; font-family: 'Segoe UI', monospace; display: flex; flex-direction: column; align-items: center; min-height: 100vh; margin: 0; padding: 20px; box-sizing: border-box; }
        .select-container { margin-top: 30px; text-align: center; width: 100%; }
        select { background-color: #1e293b; color: white; padding: 10px 20px; font-size: 16px; border: 1px solid #3b82f6; border-radius: 5px; max-width: 100%; }
        
        .drop-zone { width: 90%; max-width: 600px; height: 200px; border: 2px dashed #475569; border-radius: 10px; display: flex; flex-direction: column; justify-content: center; align-items: center; background-color: #1e293b; margin-top: 20px; transition: all 0.3s; opacity: 0.5; pointer-events: none; text-align: center; padding: 10px; box-sizing: border-box; }
        .drop-zone.unlocked { border-color: #3b82f6; opacity: 1; pointer-events: all; cursor: pointer; }
        .drop-zone.loading { border-color: #fbbf24; cursor: wait; }

        .legal-box { background-color: #1e293b; border: 1px solid #ef4444; padding: 15px; border-radius: 8px; margin-top: 20px; width: 90%; max-width: 600px; font-size: 14px; color: #cbd5e1; display: flex; align-items: flex-start; gap: 15px; box-sizing: border-box; }
        .legal-box input { margin-top: 4px; transform: scale(1.5); flex-shrink: 0; }
        
        /* ACCESS CODE INPUT */
        .code-input {
            margin-top: 15px;
            padding: 8px;
            background: #1e293b;
            border: 1px solid #64748b;
            color: white;
            border-radius: 5px;
            width: 200px;
            text-align: center;
            letter-spacing: 2px;
        }

        #report-container { display: none; width: 90%; max-width: 800px; background-color: #1e293b; border: 1px solid #475569; border-radius: 8px; margin-top: 30px; padding: 20px; box-sizing: border-box; overflow-x: hidden; }
        .btn-container { display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; margin-bottom: 20px; }
        .btn-download { background-color: #22c55e; color: black; font-weight: bold; padding: 15px 30px; border-radius: 5px; text-decoration: none; flex: 1; min-width: 200px; text-align: center; }
        .btn-upgrade { background-color: #3b82f6; color: white; font-weight: bold; padding: 15px 30px; border-radius: 5px; text-decoration: none; flex: 1; min-width: 200px; text-align: center; }
        pre { white-space: pre-wrap; word-wrap: break-word; color: #cbd5e1; font-family: 'Courier New', monospace; font-size: 13px; }
    </style>
</head>
<body>
    <div style="text-align: center;"><h1>üõ°Ô∏è COMPLIANCE CORE</h1><p>BETA // AUDIT READINESS PLATFORM</p></div>

    <div class="select-container">
        <label style="color: #94a3b8; display: block; margin-bottom: 5px;">SELECT STANDARD:</label>
        <select id="standard-select">
            <option value="NIST 800-171 Rev 2">NIST 800-171 (Defense/CMMC)</option>
            <option value="HIPAA Privacy Rule">HIPAA (Healthcare)</option>
            <option value="OSHA General Industry">OSHA (Workplace Safety)</option>
        </select>
    </div>

    <div style="text-align: center;">
        <input type="text" id="access-code" class="code-input" placeholder="ENTER PRO CODE">
    </div>

    <div class="legal-box">
        <input type="checkbox" id="legal-check">
        <div style="line-height: 1.4;"><strong>REQUIRED:</strong> I understand this is for <span style="color:#ef4444; font-weight:bold;">educational purposes only</span>. Not legal advice.</div>
    </div>

    <div id="drop-zone" class="drop-zone"><div style="font-size: 40px;">üìÇ</div><h3 id="status-text">Check Box Above to Unlock</h3></div>

    <div id="report-container">
        <div class="btn-container">
            <a id="download-link" href="#" class="btn-download" target="_blank">üìÑ DOWNLOAD REPORT</a>
            <a id="upgrade-link" href="mailto:contact@compliance-core.com?subject=Unlock%20Pro" class="btn-upgrade">‚≠ê UNLOCK PRO</a>
        </div>
        <h3 id="report-title">üìã RESULTS</h3>
        <pre id="report-content">Analysis...</pre>
    </div>

    <script>
        const dropZone = document.getElementById('drop-zone');
        const statusText = document.getElementById('status-text');
        const legalCheck = document.getElementById('legal-check');
        const accessCodeInput = document.getElementById('access-code');
        const reportContainer = document.getElementById('report-container');
        const reportContent = document.getElementById('report-content');
        const downloadLink = document.getElementById('download-link');
        const upgradeLink = document.getElementById('upgrade-link');

        legalCheck.addEventListener('change', (e) => {
            dropZone.classList.toggle('unlocked', e.target.checked);
            statusText.innerText = e.target.checked ? "Tap to Upload Policy PDF" : "Check Box Above to Unlock";
        });

        dropZone.addEventListener('click', () => { if (legalCheck.checked) document.createElement('input').click(); });
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(e => dropZone.addEventListener(e, ev => { ev.preventDefault(); }, false));
        
        dropZone.addEventListener('drop', (e) => {
            if (!legalCheck.checked) return;
            handleFile(e.dataTransfer.files[0]);
        }, false);

        // Mobile Click
        dropZone.addEventListener('click', () => {
            if (legalCheck.checked) {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = 'application/pdf';
                input.onchange = e => handleFile(e.target.files[0]);
                input.click();
            }
        });

        function handleFile(file) {
            statusText.innerText = "üß† Analyzing...";
            dropZone.classList.add('loading');
            reportContainer.style.display = 'none';

            const formData = new FormData();
            formData.append('file', file);
            formData.append('standard', document.getElementById('standard-select').value);
            formData.append('access_code', accessCodeInput.value); // SEND THE CODE

            const uploadUrl = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1' ? 'http://127.0.0.1:8000/upload' : '/upload'; 

            fetch(uploadUrl, { method: 'POST', body: formData })
            .then(r => r.json())
            .then(data => {
                dropZone.classList.remove('loading');
                statusText.innerText = "‚úÖ Complete";
                reportContainer.style.display = 'block';
                reportContent.innerText = data.report;
                downloadLink.href = data.pdf_url;
                reportContainer.scrollIntoView({ behavior: 'smooth' });

                // If code worked, hide the upgrade button!
                if (data.is_pro) {
                    upgradeLink.style.display = 'none';
                    downloadLink.innerText = "üìÑ DOWNLOAD OFFICIAL CERTIFICATE";
                }
            })
            .catch(e => { console.error(e); statusText.innerText = "Error"; });
        }
    </script>
</body>
</html>