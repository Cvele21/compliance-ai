<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compliance Core</title>
    <style>
        body { background-color: #0f172a; color: #e2e8f0; font-family: sans-serif; display: flex; flex-direction: column; align-items: center; padding: 20px; min-height: 100vh; }
        .container { width: 100%; max-width: 600px; text-align: center; }
        
        /* INPUTS */
        select, input[type="text"] { background: #1e293b; color: white; padding: 12px; border: 1px solid #3b82f6; border-radius: 5px; width: 100%; font-size: 16px; margin-top: 10px; box-sizing: border-box; }
        
        /* DROP ZONE */
        .drop-zone { border: 2px dashed #475569; border-radius: 10px; padding: 40px; margin-top: 20px; background: #1e293b; transition: 0.3s; opacity: 0.5; pointer-events: none; }
        .drop-zone.unlocked { border-color: #3b82f6; opacity: 1; pointer-events: auto; }
        .drop-zone.error { border-color: #ef4444; background: #450a0a; } 
        
        /* LEGAL CHECK */
        .legal-label { display: flex; align-items: center; gap: 10px; background: #1e293b; border: 1px solid #ef4444; padding: 15px; border-radius: 8px; margin-top: 20px; cursor: pointer; text-align: left; font-size: 13px; }

        /* REPORT AREA */
        #report-area { display: none; background: #1e293b; border: 1px solid #475569; padding: 20px; border-radius: 8px; margin-top: 20px; text-align: left; }
        .btn-download { display: block; background: #22c55e; color: black; text-align: center; padding: 15px; border-radius: 5px; text-decoration: none; font-weight: bold; margin-top: 10px; cursor: pointer; border: none; width: 100%; font-size: 16px; }
        pre { white-space: pre-wrap; font-family: monospace; color: #cbd5e1; font-size: 12px; }
    </style>
</head>
<body>

<div class="container">
    <h1>üõ°Ô∏è COMPLIANCE CORE</h1>
    <p>BETA // AUDIT READINESS</p>

    <select id="standard">
        <option value="NIST 800-171">NIST 800-171 (Defense)</option>
        <option value="HIPAA Privacy">HIPAA (Healthcare)</option>
        <option value="OSHA Safety">OSHA (Workplace Safety)</option>
    </select>

    <input type="text" id="access-code" placeholder="Enter Access Code (Required)" />

    <label class="legal-label">
        <input type="checkbox" id="legal-check">
        <div><strong>REQUIRED:</strong> Tap here to accept educational use only. Not legal advice.</div>
    </label>

    <div id="drop-zone" class="drop-zone">
        <div id="icon" style="font-size: 40px;">üîí</div>
        <h3 id="status">Tap Checkbox to Unlock</h3>
    </div>

    <div id="report-area">
        <h3>üìã ANALYSIS COMPLETE</h3>
        <pre id="report-text">...</pre>
        
        <form action="/download_report" method="POST" target="_blank">
            <input type="hidden" name="report_content" id="hidden-content">
            <button type="submit" class="btn-download">üìÑ DOWNLOAD REPORT (.TXT)</button>
        </form>
    </div>
</div>

<script>
    const legalCheck = document.getElementById('legal-check');
    const dropZone = document.getElementById('drop-zone');
    const status = document.getElementById('status');
    const reportArea = document.getElementById('report-area');
    
    // Unlock Logic
    legalCheck.addEventListener('change', (e) => {
        if(e.target.checked) {
            dropZone.classList.add('unlocked');
            status.innerText = "Tap Here to Upload PDF";
        } else {
            dropZone.classList.remove('unlocked');
            status.innerText = "Tap Checkbox to Unlock";
        }
    });

    // File Selection
    dropZone.addEventListener('click', () => {
        if(!legalCheck.checked) return;
        let input = document.createElement('input');
        input.type = 'file';
        input.onchange = e => handleUpload(e.target.files[0]);
        input.click();
    });

    function handleUpload(file) {
        status.innerText = "Authenticating...";
        dropZone.classList.remove('error');
        
        const formData = new FormData();
        formData.append('file', file);
        formData.append('standard', document.getElementById('standard').value);
        // SEND THE CODE TO SERVER
        formData.append('access_code', document.getElementById('access-code').value);

        fetch('/upload', { method: 'POST', body: formData })
        .then(async response => {
            if (!response.ok) {
                let err = await response.json();
                throw new Error(err.detail); 
            }
            return response.json();
        })
        .then(data => {
            status.innerText = "Done ‚úÖ";
            reportArea.style.display = 'block';
            document.getElementById('report-text').innerText = data.report;
            document.getElementById('hidden-content').value = data.report;
        })
        .catch(error => {
            dropZone.classList.add('error');
            status.innerText = "‚ùå " + error.message;
        });
    }
</script>

</body>
</html>